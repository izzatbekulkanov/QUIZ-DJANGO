{% extends 'dashboard/index.html' %}
{% load static %}

{% block style %}

{% endblock style %}

{% block content %}
<main id="main-container" class="font-roboto">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="bg-light border-bottom mb-4">
        <div class="content py-2">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a href="{% url 'dashboard' %}"><i class="fa fa-home"></i> Bosh sahifa</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Natijalar</li>
            </ol>
        </div>
    </nav>
    <!-- END Breadcrumb -->
    <div class="content">
        <h2 class="mb-4">Mening Natijalarim</h2>
        <!-- Filtr shakli -->
        <div class="d-flex align-items-center mb-4 filter-form">
            <form class="d-flex align-items-center gap-3" method="get" action="{% url 'all_results' %}">
                <select name="category" class="form-select">
                    <option value="">Kategoriya tanlang</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"s" == request.GET.category %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">
                    Filtrlash
                </button>
            </form>
        </div>

        <!-- Natijalar jadvali -->
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-primary text-center">
                    <tr>
                        <th>#</th>
                        <th>Kategoriya</th>
                        <th>Test</th>
                        <th>Boshlash vaqti</th>
                        <th>Yakunlash vaqti</th>
                        <th>Baho</th>
                    </tr>
                </thead>
                <tbody>
                    {% if results %}
                        {% for result in results %}
                        <tr>
                            <td class="text-center">{{ forloop.counter }}</td>
                            <td>{{ result.assignment.category.name }}</td>
                            <td>{{ result.assignment.test.name }}</td>
                            <td class="text-center">{{ result.start_time|date:"Y-m-d H:i" }}</td>
                            <td class="text-center">{{ result.end_time|date:"Y-m-d H:i" }}</td>
                            <td class="text-center">{{ result.score|floatformat:2 }}%</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center">
                                <div class="no-data-container">
                                    <img src="{% static 'img/no-data.webp' %}" alt="No Data" class="no-data-img">
                                    <p class="no-data-text">Hozircha natijalar mavjud emas</p>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Paginatsiya -->
        <div class="d-flex justify-content-center flex-wrap gap-2 mt-4">
            {% if results.has_previous %}
                <a
                    href="?page=1{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
                    class="btn btn-primary btn-sm"
                >
                    Birinchi
                </a>
                <a
                    href="?page={{ results.previous_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
                    class="btn btn-primary btn-sm"
                >
                    Oldingi
                </a>
            {% endif %}
            <span class="btn btn-primary btn-sm disabled">
                {{ results.number }} / {{ results.paginator.num_pages }}
            </span>
            {% if results.has_next %}
                <a
                    href="?page={{ results.next_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
                    class="btn btn-primary btn-sm"
                >
                    Keyingisi
                </a>
                <a
                    href="?page={{ results.paginator.num_pages }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
                    class="btn btn-primary btn-sm"
                >
                    Oxirgi
                </a>
            {% endif %}
        </div>
    </div>
</main>
{% endblock content %}

{% block script %}
<script src="{% static 'assets/js/plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
<script>
    document.querySelectorAll('.btn-primary').forEach(btn => {
        btn.addEventListener('click', function() {
            this.classList.add('btn-clicked');
            setTimeout(() => {
                this.classList.remove('btn-clicked');
            }, 100);
        });
    });
</script>
{% endblock script %}