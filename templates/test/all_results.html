{% extends 'dashboard/index.html' %}
{% load static %}

{% block style %}
  <style>
    /* Custom styles for table */
    .results-table th, .results-table td {
        vertical-align: middle;
        text-align: center;
    }

    .filter-form input, .filter-form select {
        margin-right: 10px;
    }
</style>
{% endblock style %}


{% block content %}
<main id="main-container">
    <div class="content">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="h3 mb-0">Barcha Natijalar</h2>
            <form class="filter-form d-flex" method="get" action="{% url 'all_results' %}">
                <input type="text" name="first_name" placeholder="Ism" value="{{ request.GET.first_name }}" class="form-control">
                <input type="text" name="second_name" placeholder="Familiya" value="{{ request.GET.second_name }}" class="form-control">
                <select name="category" class="form-select">
                    <option value="">Kategoriya tanlang</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"s" == request.GET.category %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary">Filter</button>
            </form>
        </div>

        <table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Foydalanuvchi</th>
            <th>Kategoriya</th>
            <th>Test</th>
            <th>Boshlash vaqti</th>
            <th>Yakunlash vaqti</th>
            <th>Baho</th>
        </tr>
    </thead>
    <tbody>
        {% for result in results %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ result.student.full_name }}</td>
            <td>{{ result.assignment.category.name }}</td>
            <td>{{ result.assignment.test.name }}</td>
            <td>{{ result.start_time }}</td>
            <td>{{ result.end_time }}</td>
            <td>{{ result.score|floatformat:2 }}%</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    <span class="step-links">
        {% if results.has_previous %}
            <a href="?page=1{% if request.GET.first_name %}&first_name={{ request.GET.first_name }}{% endif %}{% if request.GET.second_name %}&second_name={{ request.GET.second_name }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Birinchi</a>
            <a href="?page={{ results.previous_page_number }}{% if request.GET.first_name %}&first_name={{ request.GET.first_name }}{% endif %}{% if request.GET.second_name %}&second_name={{ request.GET.second_name }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Oldingi</a>
        {% endif %}

        <span class="current">
            {{ results.number }} / {{ results.paginator.num_pages }}
        </span>

        {% if results.has_next %}
            <a href="?page={{ results.next_page_number }}{% if request.GET.first_name %}&first_name={{ request.GET.first_name }}{% endif %}{% if request.GET.second_name %}&second_name={{ request.GET.second_name }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Keyingisi</a>
            <a href="?page={{ results.paginator.num_pages }}{% if request.GET.first_name %}&first_name={{ request.GET.first_name }}{% endif %}{% if request.GET.second_name %}&second_name={{ request.GET.second_name }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">Oxirgi</a>
        {% endif %}
    </span>
</div>
    </div>
</main>
{% endblock content %}



{% block script %}

    <script src="{% static 'assets/js/plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
  
{% endblock script %}