{% extends 'question/main.html' %}
{% load static %}

{% block style %}
<!-- No custom styles -->
{% endblock style %}

{% block content %}
<main id="main-container" class="container-fluid px-0">
  <!-- Hero -->
  <div class="bg-primary bg-opacity-75 py-4" style="background-image: url('{% static 'assets/media/photos/photo3@2x.jpg' %}'); background-size: cover; background-position: center;">
    <div class="container">
      <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center my-4 text-center text-sm-start">
        <div class="flex-grow-1">
          <h1 class="fw-semibold text-white mb-0">Savollar</h1>
          <h2 class="h4 fw-normal text-white-75 mb-0">Savollar tahrirlash</h2>
        </div>
        <div class="mt-3 mt-sm-0">
          <a href="javascript:history.back()" class="btn btn-outline-secondary">
            <i class="fa fa-arrow-left me-1"></i> Ortga
          </a>
        </div>
      </div>
    </div>
  </div>
  <!-- END Hero -->

  <!-- Page Content -->
  <div class="container my-4">
    <!-- Question Edit Form -->
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h3 class="card-title mb-4">Testni Tahrirlash</h3>
        <form method="POST" action="{% url 'edit-test' test.id %}" id="editTestForm">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="text-end">
            <button type="submit" class="btn btn-primary">
              <i class="fa fa-save me-1"></i> Saqlash
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>
{% endblock content %}

{% block script %}
<script src="{% static 'assets/js/plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
<script>
  document.getElementById('editTestForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const form = this;
    Swal.fire({
      title: 'Tasdiqlaysizmi?',
      text: "Ushbu testni yangilamoqchimisiz?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#0d6efd',
      cancelButtonColor: '#dc3545',
      confirmButtonText: 'Ha, yangilash!',
      cancelButtonText: 'Bekor qilish'
    }).then((result) => {
      if (result.isConfirmed) {
        const formData = new FormData(form);
        fetch(form.action, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            Swal.fire({
              title: data.success ? 'Muvaffaqiyatli!' : 'Xatolik!',
              text: data.message || 'Testni yangilashda xatolik yuz berdi.',
              icon: data.success ? 'success' : 'error',
              confirmButtonText: 'OK'
            }).then(() => {
              if (data.success) {
                window.location.href = '{% url "question" %}';
              }
            });
          })
          .catch(error => {
            Swal.fire({
              title: 'Xatolik!',
              text: 'Server bilan bogâ€˜lanishda xatolik yuz berdi.',
              icon: 'error',
              confirmButtonText: 'OK'
            });
            console.error('Error:', error);
          });
      }
    });
  });
</script>
{% endblock script %}