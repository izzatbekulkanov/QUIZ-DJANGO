{% extends 'question/main.html' %}
{% load static %}
{% block style %}
{% endblock style %}
{% block content %}
<main id="main-container">
  <!-- Hero -->
  <div class="bg-image overflow-hidden" style="background-image: url('{% static "assets/media/photos/photo3@2x.jpg" %}');">
  <div class="bg-primary-dark-op">
    <div class="content content-full">
      <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center mt-5 mb-2 text-center text-sm-start">
        <div class="flex-grow-1">
          <h1 class="fw-semibold text-white mb-0">Users</h1>
          <h2 class="h4 fw-normal text-white-75 mb-0">Welcome To Edit User</h2>
        </div>
        <div class="mt-3 mt-sm-0">
          <!-- Back Button -->
          <a href="javascript:history.back()" class="btn btn-alt-secondary">
          <i class="fa fa-arrow-left me-1"></i> Ortga
          </a>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- END Hero -->
  <!-- Page Content -->
  <div class="content">
    <!-- User Creation Form -->
    <div class="card m-3  p-3">
      <form id="editUserForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="first_name">Ism</label>
            <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="second_name">Familiya</label>
            <input type="text" class="form-control" id="second_name" name="second_name" value="{{ user.second_name }}" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="phone_number">Telefon raqam</label>
            <input type="text" class="form-control" id="phone_number" name="phone_number" value="{{ user.phone_number }}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="address">Manzil</label>
            <input type="text" class="form-control" id="address" name="address" value="{{ user.address }}" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="date_of_birth">Tug'ilgan sana</label>
            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" value="{{ user.date_of_birth|date:'Y-m-d' }}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="gender">Jinsi</label>
            <select class="form-select" id="gender" name="gender" required>
            <option value="male" {% if user.gender == "male" %}selected{% endif %}>Erkak</option>
            <option value="female" {% if user.gender == "female" %}selected{% endif %}>Ayol</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label" for="nationality">Millati</label>
            <select class="form-select" id="nationality" name="nationality" required>
            <option value="" disabled {% if not user.nationality %}selected{% endif %}>Millatingizni tanlang</option>
            <option value="Uzbek" {% if user.nationality == "Uzbek" %}selected{% endif %}>O'zbek</option>
            <option value="Kazakh" {% if user.nationality == "Kazakh" %}selected{% endif %}>Qozoq</option>
            <option value="Kyrgyz" {% if user.nationality == "Kyrgyz" %}selected{% endif %}>Qirg'iz</option>
            <option value="Tajik" {% if user.nationality == "Tajik" %}selected{% endif %}>Tojik</option>
            <option value="Turkmen" {% if user.nationality == "Turkmen" %}selected{% endif %}>Turkman</option>
            <option value="Afghan" {% if user.nationality == "Afghan" %}selected{% endif %}>Afg'on</option>
            <option value="Pakistani" {% if user.nationality == "Pakistani" %}selected{% endif %}>Pokistonlik</option>
            <option value="Indian" {% if user.nationality == "Indian" %}selected{% endif %}>Hind</option>
            <option value="Chinese" {% if user.nationality == "Chinese" %}selected{% endif %}>Xitoylik</option>
            <option value="Japanese" {% if user.nationality == "Japanese" %}selected{% endif %}>Yapon</option>
            <option value="Korean" {% if user.nationality == "Korean" %}selected{% endif %}>Koreys</option>
            <option value="Malaysian" {% if user.nationality == "Malaysian" %}selected{% endif %}>Malayziyalik</option>
            <option value="Indonesian" {% if user.nationality == "Indonesian" %}selected{% endif %}>Indoneziyalik</option>
            <option value="Filipino" {% if user.nationality == "Filipino" %}selected{% endif %}>Filippinlik</option>
            <option value="Vietnamese" {% if user.nationality == "Vietnamese" %}selected{% endif %}>Vetnamlik</option>
            <option value="Thai" {% if user.nationality == "Thai" %}selected{% endif %}>Tay</option>
            <option value="Bangladeshi" {% if user.nationality == "Bangladeshi" %}selected{% endif %}>Bangladeshlik</option>
            <option value="Sri Lankan" {% if user.nationality == "Sri Lankan" %}selected{% endif %}>Shri-Lankalik</option>
            <option value="Nepali" {% if user.nationality == "Nepali" %}selected{% endif %}>Nepallik</option>
            <option value="Mongolian" {% if user.nationality == "Mongolian" %}selected{% endif %}>Mo'g'ul</option>
            <option value="Iranian" {% if user.nationality == "Iranian" %}selected{% endif %}>Eronlik</option>
            <option value="Iraqi" {% if user.nationality == "Iraqi" %}selected{% endif %}>Iroqlik</option>
            <option value="Saudi Arabian" {% if user.nationality == "Saudi Arabian" %}selected{% endif %}>Saudiya Arabistonlik</option>
            <option value="Syrian" {% if user.nationality == "Syrian" %}selected{% endif %}>Suriya</option>
            <option value="Jordanian" {% if user.nationality == "Jordanian" %}selected{% endif %}>Iordaniyalik</option>
            <option value="Palestinian" {% if user.nationality == "Palestinian" %}selected{% endif %}>Falastinlik</option>
            <option value="Turkish" {% if user.nationality == "Turkish" %}selected{% endif %}>Turk</option>
            <option value="Armenian" {% if user.nationality == "Armenian" %}selected{% endif %}>Arman</option>
            <option value="Azerbaijani" {% if user.nationality == "Azerbaijani" %}selected{% endif %}>Ozarbayjonlik</option>
            <option value="Georgian" {% if user.nationality == "Georgian" %}selected{% endif %}>Gruzin</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="profile_picture">Profil rasmi</label>
            <input type="file" class="form-control" id="profile_picture" name="profile_picture">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="job_title">Lavozimi</label>
            <input type="text" class="form-control" id="job_title" name="job_title" value="{{ user.job_title }}">
          </div>
          <div class="col-md-6 mb-3">
            <label for="company_name">Ish joyi</label>
            <input type="text" class="form-control" id="company_name" name="company_name" value="{{ user.company_name }}">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="username">Username</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="password">Yangi Parol</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Parolni kiriting">
          </div>
          <div class="col-md-6 mb-3">
            <label for="confirm_password">Parolni Tasdiqlash</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Parolni tasdiqlang">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="is_teacher">O'qituvchi</label>
            <input type="checkbox" id="is_teacher" name="is_teacher" {% if user.is_teacher %}checked{% endif %}>
          </div>
          <div class="col-md-6 mb-3">
            <label for="is_student">Talaba</label>
            <input type="checkbox" id="is_student" name="is_student" {% if user.is_student %}checked{% endif %}>
          </div>
        </div>
        <div class="text-end">
          <button type="button" id="submitButton" class="btn btn-primary w-100">Yangilash</button>
        </div>
      </form>
    </div>
  </div>
</main>
{% endblock content %}
{% block script %}
<script src="{% static 'assets/js/plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
<script>
  document.getElementById("submitButton").addEventListener("click", function () {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;

    // Parol bir xilligini tekshirish
    if (password && password !== confirmPassword) {
      Swal.fire({
        title: 'Xatolik!',
        text: 'Parollar mos kelmadi. Iltimos, qayta tekshiring.',
        icon: 'error',
        confirmButtonText: 'OK',
      });
      return; // Formani yuborishni to'xtatish
    }

    Swal.fire({
      title: 'Tasdiqlaysizmi?',
      text: "Foydalanuvchi ma'lumotlarini yangilamoqchimisiz?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Ha, yangilash!',
      cancelButtonText: 'Bekor qilish',
    }).then((result) => {
      if (result.isConfirmed) {
        const form = document.getElementById("editUserForm");
        const formData = new FormData(form);

        // AJAX so'rov yuborish
        fetch(form.action, {
          method: "POST",
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              Swal.fire({
                title: 'Muvaffaqiyatli!',
                text: data.message,
                icon: 'success',
                confirmButtonText: 'OK',
              }).then(() => {
                window.location.reload(); // Sahifani qayta yuklash
              });
            } else {
              Swal.fire({
                title: 'Xatolik!',
                text: data.message,
                icon: 'error',
                confirmButtonText: 'OK',
              });
            }
          })
          .catch((error) => {
            Swal.fire({
              title: 'Xatolik!',
              text: 'Maʼlumotlarni yuborishda xatolik yuz berdi.',
              icon: 'error',
              confirmButtonText: 'OK',
            });
          });
      }
    });
  });
</script>

{% endblock script %}