{% extends 'question/main.html' %}
{% load static %}
{% block style %}
{% endblock style %}
{% block content %}
<main id="main-container">
  <!-- Hero -->
  <div class="bg-image overflow-hidden" style="background-image: url('{% static "assets/media/photos/photo3@2x.jpg" %}');">
  <div class="bg-primary-dark-op">
    <div class="content content-full">
      <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center mt-5 mb-2 text-center text-sm-start">
        <div class="flex-grow-1">
          <h1 class="fw-semibold text-white mb-0">Savollar</h1>
          <h2 class="h4 fw-normal text-white-75 mb-0">Savollar qo'shish</h2>
        </div>
        <div class="mt-3 mt-sm-0">
          <!-- Back Button -->
          <a href="javascript:history.back()" class="btn btn-alt-secondary">
          <i class="fa fa-arrow-left me-1"></i> Ortga
          </a>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- END Hero -->
  <!-- Page Content -->
  <div class="content">
    <!-- Add Test Form -->
    <div class="card m-3 p-3">
      <h3 class="mb-4"><i class="fa fa-plus me-2"></i>Yangi Test Yaratish</h3>
      <form id="addTestForm" method="POST" action="{% url 'add-question' %}">
        {% csrf_token %}
        <!-- Category Dropdown -->
        <div class="mb-4">
          <label class="form-label" for="test-category"><i class="fa fa-folder-open me-2"></i>Kategoriya</label>
          <select class="form-select" id="test-category" name="category" required>
            <option value="" disabled selected>Kategoriya tanlang</option>
            {% for category in categories %}
            <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
          </select>
        </div>
        <!-- Test Name -->
        <div class="mb-4">
          <label class="form-label" for="test-name"><i class="fa fa-file-text me-2"></i>Test Nomi</label>
          <input type="text" class="form-control" id="test-name" name="name" placeholder="Test nomini kiriting" required>
        </div>
        <!-- Test Description -->
        <div class="mb-4">
          <label class="form-label" for="test-description"><i class="fa fa-info-circle me-2"></i>Ta'rif</label>
          <textarea class="form-control" id="test-description" name="description" rows="4" placeholder="Test haqida qisqacha ma'lumot"></textarea>
        </div>

        <!-- Submit Button -->
        <div class="text-end">
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-save me-1"></i> Saqlash
          </button>
        </div>
      </form>
    </div>
  </div>
</main>
{% endblock content %}
{% block script %}
<script src="{% static 'assets/js/plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
<script>
  document.getElementById('addTestForm').addEventListener('submit', function (e) {
    e.preventDefault(); // Prevent default form submission

    Swal.fire({
      title: 'Tasdiqlaysizmi?',
      text: "Yangi testni qo'shmoqchimisiz?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Ha, qo‘shish!',
      cancelButtonText: 'Bekor qilish',
    }).then((result) => {
      if (result.isConfirmed) {
        const form = this;
        const formData = new FormData(form);

        fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              Swal.fire({
                title: 'Muvaffaqiyatli!',
                text: data.message,
                icon: 'success',
                confirmButtonText: 'OK',
              }).then(() => {
                form.reset(); // Clear the form
                window.location.href = '{% url "question" %}'; // Redirect to questions page
              });
            } else {
              Swal.fire({
                title: 'Xatolik!',
                text: data.message || 'Maʼlumotni saqlashda xatolik yuz berdi.',
                icon: 'error',
                confirmButtonText: 'OK',
              });
            }
          })
          .catch((error) => {
            Swal.fire({
              title: 'Xatolik!',
              text: 'Server bilan bog‘lanishda xatolik yuz berdi.',
              icon: 'error',
              confirmButtonText: 'OK',
            });
            console.error('Error:', error);
          });
      }
    });
  });
</script>

{% endblock script %}